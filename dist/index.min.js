!function(){var l,h,r,t;function o(t,i){var e,o={}.hasOwnProperty;for(e in i)o.call(i,e)&&(t[e]=i[e]);return t}l=function(t){return Papa.parse(t).data},h=function(t,i,e){for(var o=t;t&&t!==e;)t=t.parentNode;if(t!==e)return null;if(!i)return t;for(t=o;t&&t!==e&&(!t.matches||t.matches&&!t.matches(i));)t=t.parentNode;return t!==e||e.matches&&e.matches(i)?t:null},r=function(t){for(var i=Math.floor(Math.log(25*(t+1)+1)/Math.log(26))-1,e=t-((Math.pow(26,1+i)-1)/25-1),o="",s=0;s<=i;++s)o="ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(e%26)+o,e=(e-e%26)/26;return o},(t=function(t){var i,e=this;return this.opt=t=null==t?{}:t,this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.evtHandler={},this._data=t.data||[],this._size={row:(i=o({row:[],col:[]},t.size)).row,col:i.col},this.cls={row:(i=o({row:[],col:[]},t.class)).row,col:i.col},this._editing=null==t.editing||!!t.editing,this.dim={col:(t.dim||(t.dim={})).col||30,row:(t.dim||(t.dim={})).row||30},this.frozen={col:(i=o({col:0,row:0},t.frozen||{})).col,row:i.row},this.idx={col:(i=o({row:!0,col:!0},t.idx||{})).col,row:i.row},this.fixed={col:(i=o({col:0,row:0},t.fixed||{})).col,row:i.row},this.xif={row:[this.idx.row?1:0,0,0],col:[this.idx.col?1:0,0,0]},["row","col"].map(function(t){return e.xif[t][1]=e.xif[t][0]+e.fixed[t],e.xif[t][2]=e.xif[t][1]+e.frozen[t]}),this.fix={row:this.xif.row[2],col:this.xif.col[2]},this.pos={col:0,row:0},this.scrollPos={x:0,y:0},this.sel={},this.les={},this.editing={},this.dom=Object.fromEntries(["sheet","inner","caret","range","edit","layout"].map(function(t){var i;i=document.createElement("div");return i.classList.add(t),[t,i]})),this.dom.sheet.setAttribute("tabindex",-1),this.dom.textarea=document.createElement("textarea"),this.root.appendChild(this.dom.sheet),["inner","caret","range","edit","layout"].map(function(t){return e.dom.sheet.appendChild(e.dom[t])}),this.dom.edit.appendChild(this.dom.textarea),this._init(),this}).prototype=o(Object.create(Object.prototype),{on:function(t,i){var e;return((e=this.evtHandler)[t]||(e[t]=[])).push(i)},fire:function(t){for(var i,e,o,s,r=[],n=[],l=1,h=arguments.length;l<h;++l)n.push(arguments[l]);for(i=n,l=0,o=(e=this.evtHandler[t]||[]).length;l<o;++l)s=e[l],r.push(s.apply(this,i));return r},_init:function(){for(var t,i,e,o,s,f=this,r=0,n=this.dim.row;r<n;++r)for(t=r,i=0,e=this.dim.col;i<e;++i)o=i,this.addCell(o,t);return this.regrid(),this.dom.textarea.addEventListener("mousedown",function(t){return t.stopPropagation()}),(s=this.dom.sheet).addEventListener("mousedown",function(t){var i,e;if(f.edited(),(i=h(t.target,".cell",s))&&!((e={row:(e=f.index(i)).row,col:e.col}).col<0||e.row<0))return t.shiftKey&&f.les.start?f.les.end=e:(f.les.start=f.les.end=e,f.les.node=i),f.renderSelection()}),s.addEventListener("mousemove",function(t){var i;if(!f.editing.on&&t.buttons&&(i=h(t.target,".cell",s)))return f.les.end={row:(i=f.index(i)).row,col:i.col},f.renderSelection()}),s.addEventListener("dblclick",function(t){if(t=h(t.target,".cell",s))return f.edit({node:t,quick:!1})}),document.body.addEventListener("paste",function(t){if(h(document.activeElement,".sheet",s)&&f.les.start)return t=t.clipboardData.getData("text"),t=l(t),f.set({row:f.les.start.row,col:f.les.start.col,data:t,range:!0})}),s.addEventListener("keydown",function(t){var i,e,o,s,r,n,l,h,d,c,a;if(67===t.keyCode&&(t.metaKey||t.ctrlKey))return f.copy();if(f.eventInScope(t)){if(8===(i=t.keyCode)){if(!f.les.node)return;for(s=(a=(e=(a=[f.les.start,f.les.end])[0]).col<(o=a[1]).col?[e.col,o.col]:[o.col,e.col])[0],r=a[1],n=(a=e.row<o.row?[e.row,o.row]:[o.row,e.row])[1],l=a[0];l<=n;++l)for(h=l,d=s;d<=r;++d)c=d,f.set({row:h,col:c,data:""})}if((a=function(){switch(i){case 37:return{y:0,x:-1};case 38:return{y:-1,x:0};case 39:return{y:0,x:1};case 40:return{y:1,x:0};default:return null}}())&&(!f.editing.on||f.editing.quick))return f.move(a),t.stopPropagation(),t.preventDefault(),f.dom.sheet.focus()}}),s.addEventListener("keypress",function(t){if(f.les.node&&!f.editing.on)return f.edit({node:f.les.node,quick:13!==t.keyCode})}),this.dom.textarea.addEventListener("keydown",function(t){var i,e,o;return 27===t.keyCode?(f.edited({cancel:!0}),t.stopPropagation(),t.preventDefault(),void f.dom.sheet.focus()):13!==t.keyCode||t.altKey||t.metaKey?13===t.keyCode&&(t.altKey||t.metaKey)?(f.dom.textarea.value+="\n",f.dom.layout.textContent=f.dom.textarea.value+" ",i=f.dom.layout.getBoundingClientRect(),e=f.editing.node.getBoundingClientRect(),(o=f.dom.textarea.style).width=Math.max(i.width,e.width+1)+"px",o.height=Math.max(i.height,e.height+1)+"px",o):void 0:(f.move({y:1,x:0}),t.stopPropagation(),t.preventDefault(),void f.dom.sheet.focus())}),document.addEventListener("wheel",function(t){var i,e,o,s,r=f.eventInScope(t);return(null==f.opt.scrollLock||f.opt.scrollLock)&&Math.abs(t.deltaX)>Math.abs(t.deltaY)&&(!r&&t.target!==document.body||t.preventDefault()),!!r&&(i=f.scrollPos,e=(s=[t.deltaX,t.deltaY])[0],o=s[1],e=(s=Math.abs(e)>Math.abs(o)?[e,0]:[0,o])[0],o=s[1],r=(s=[i.x,i.y])[0],s=s[1],i.x+=e/30,i.y+=o/30,e=Math.round(i.x)-Math.round(r),0<(o=Math.round(i.y)-Math.round(s))?f._md(o):o<0?f._mu(o):0<e?f._mr(e):e<0&&f._ml(e),f.renderSelection(),t.preventDefault())},{passive:!1})},copy:function(){var t,i,e,o,s,r,n,l,h;if(this.les.start){for(t=[],i=this.les.start.row,e=this.les.end.row+1;i<e;++i){for(o=[],s=this.les.start.col,r=this.les.end.col+1;s<r;++s)n=s,"object"!=typeof(n=((l=this._data)[rpw]||(l[rpw]=[]))[n])&&o.push('"'+(""+n||"").replace(/"/g,'""')+'"');t.push(o.join("\t"))}return h=t.join("\n"),navigator.clipboard.writeText(h)}},eventInScope:function(t){return h(t.target,".sheet",this.dom.sheet)===this.dom.sheet},size:function(t){return null==t?this._size:(this._size={row:(t=o({row:[],col:[]},t)).row,col:t.col},this.regrid())},regrid:function(){var i=this;return this.dom.inner.style.gridTemplateColumns="repeat("+this.xif.col[1]+", max-content) "+function(){for(var t=[],i=0,e=this.frozen.col;i<e;++i)t.push(i);return t}.call(this).map(function(t){return i._size.col[t]||"max-content"}).join(" ")+" "+function(){for(var t=[],i=this.xif.col[2],e=this.dim.col;i<e;++i)t.push(i);return t}.call(this).map(function(t){return i._size.col[t+i.pos.col-i.xif.col[1]]||"max-content"}).join(" "),this.dom.inner.style.gridTemplateRows="repeat("+this.xif.row[1]+", max-content) "+function(){for(var t=[],i=0,e=this.frozen.row;i<e;++i)t.push(i);return t}.call(this).map(function(t){return i._size.row[t]||"max-content"}).join(" ")+" "+function(){for(var t=[],i=this.xif.row[2],e=this.dim.row;i<e;++i)t.push(i);return t}.call(this).map(function(t){return i._size.row[t+i.pos.row-i.xif.row[1]]||"max-content"}).join(" ")},addCell:function(t,i){var e=document.createElement("div");return this.dom.inner.insertBefore(e,this.dom.inner.childNodes[i*this.dim.col+t]),this._content({x:t,y:i,n:e})},set:function(t){var i,e,o,s,r,n,l,h,d=t.row,c=t.col,a=t.data,t=t.range;if(t)for(e=0,o=a.length;e<o;++e)for(r=0,n=a[s=e].length;r<n;++r)l=r,((i=this._data)[h=s+d]||(i[h]=[]))[l+c]=a[s][l],this._content({y:s+d-this.pos.row+this.xif.row[1],x:l+c-this.pos.col+this.xif.col[1]});else((i=this._data)[d]||(i[d]=[]))[c]=a,this._content({y:d-this.pos.row+this.xif.row[1],x:c-this.pos.col+this.xif.col[1]});return this.fire("change",{row:d,col:c,data:a,range:!!t})},_content:function(t){var i,e,o=t.x,s=t.y,t=t.n;if(t=t||this.dom.inner.childNodes[o+s*this.dim.col])return i=(e=o<this.xif.col[0]&&s<this.xif.col[0]?["","cell idx"]:o<this.xif.col[0]?[s<this.xif.row[1]?" ":s<this.xif.row[2]?s-this.xif.row[1]+1:s-this.xif.row[1]+this.pos.row+1,"cell idx"]:s<this.xif.row[0]?[o<this.xif.col[1]?" ":o<this.xif.col[2]?r(o-this.xif.col[1]):r(o-this.xif.col[1]+this.pos.col),"cell idx"]:o<this.xif.col[1]||s<this.xif.row[1]?[null,"cell fixed"]:o<this.xif.col[2]&&s<this.xif.row[2]?[((e=this._data)[i=s-this.xif.row[1]]||(e[i]=[]))[o-this.xif.col[1]],"cell frozen fixed"]:o<this.xif.col[2]?[((e=this._data)[i=this.pos.row+s-this.xif.row[1]]||(e[i]=[]))[o-this.xif.col[1]],"cell frozen"]:s<this.xif.row[2]?[((e=this._data)[i=s-this.xif.row[1]]||(e[i]=[]))[this.pos.col+o-this.xif.col[1]],"cell frozen"]:[((e=this._data)[i=this.pos.row+s-this.xif.row[1]]||(e[i]=[]))[this.pos.col+o-this.xif.col[1]],"cell"])[0],e=e[1],null==i&&(i=""),s=o>=this.xif.col[0]&&s>=this.xif.row[0]?(this.cls.col[this.pos.col+o-this.xif.col[1]]||"")+" "+(this.cls.row[this.pos.row+s-this.xif.row[1]]||""):"",t.className=e+" "+s,null!==i?"object"!=typeof i?t.textContent=i:"dom"===i.type?(t.textContent="",t.appendChild(i.node)):void 0:void 0},_md:function(t){var i,e,o,s,r,n,l,h,d;for(null==t&&(t=1),i=this.dom.inner,o=e=0<(e=(t=Math.round(Math.abs(t)))-(this.dim.row-this.fix.row))?e:0;o<t;++o)for(s=o,r=0,n=this.dim.col;r<n&&(l=r,h=this.dim.col*this.fix.row,i.childNodes[h]);++r)i.removeChild(i.childNodes[h]);for(o=e;o<t;++o)for(s=o,r=0,n=this.dim.col;r<n;++r)l=r,d=document.createElement("div"),this._content({x:l,y:this.dim.row+s,n:d}),i.appendChild(d);return this.pos.row+=t},_mu:function(t){var i,e,o,s,r,n,l,h,d,c,a=[];if(null==t&&(t=1),i=this.dom.inner,!(this.pos.row<=0)){for(s=e=0<(o=(t=(t=Math.round(Math.abs(t)))>=this.pos.row?this.pos.row:t)-(this.dim.row-this.xif.row[2]))?o:0;s<t;++s)for(r=s,n=0,l=this.dim.col;n<l&&(h=n,i.childNodes.length);++n)i.removeChild(i.childNodes[i.childNodes.length-1]);for(this.pos.row-=t,s=e;s<t;++s){for(r=s,d=[],n=0,l=this.dim.col;n<l;++n)h=n,c=document.createElement("div"),this._content({x:h,y:r+this.xif.row[2],n:c}),d.push(i.insertBefore(c,i.childNodes[h+(r-e)*this.dim.col+this.dim.col*this.xif.row[2]]));a.push(d)}return a}},_mr:function(t){var i,e,o,s,r,n,l,h;for(null==t&&(t=1),i=this.dom.inner,o=0<(e=(t=Math.round(Math.abs(t)))-(this.dim.col-this.fix.col))?e:0;o<t;++o)for(s=o,r=0,n=this.dim.row;r<n;++r)l=r,i.removeChild(i.childNodes[l*this.dim.col+this.fix.col]),h=document.createElement("div"),this._content({x:this.dim.col+s,y:l,n:h}),i.insertBefore(h,i.childNodes[(l+1)*this.dim.col-1]);return this.pos.col+=t,this.regrid()},_ml:function(t){var i,e,o,s,r,n,l,h,d;if(null==t&&(t=1),i=this.dom.inner,(t=Math.round(Math.abs(t)))>=this.pos.col&&(t=this.pos.col),!(this.pos.col<=0||t<=0)){for(e=0<(o=t-(this.dim.col-this.xif.col[2]))?o:0,this.pos.col-=t,s=e;s<t;++s)for(r=s,n=0,l=this.dim.row;n<l;++n)h=n,i.removeChild(i.childNodes[(h+1)*this.dim.col-1]),d=document.createElement("div"),this._content({x:r+this.xif.col[2],y:h,n:d}),i.insertBefore(d,i.childNodes[h*this.dim.col+this.xif.col[2]+r-e]);return this.regrid()}},goto:function(t){return o(this.pos,t=null==t?{row:0,col:0}:t),this.render()},render:function(){for(var t,i,e,o,s,r=[],n=0,l=this.dim.row;n<l;++n){for(t=n,i=[],e=0,o=this.dim.col;e<o;++e)s=e,i.push(this._content({x:s,y:t}));r.push(i)}return r},move:function(t){var i,e,o,s;if(null==t&&(t={}),this.editing.on&&this.edited(),(t.node=this.les.node)&&(s=this.cell(t))){if(i=this.index(s),e=s.getBoundingClientRect(),o=this.dom.sheet.getBoundingClientRect(),e.x+e.width>o.x+o.width&&this._mr(1),e.y+e.height>o.y+o.height&&this._md(1),0===i.x){if(0===this.pos.col)return;this._ml(1)}if(0===i.y){if(0===this.pos.row)return;this._mu(1)}if(s=this.cell(t))return this.les.node=s,this.les.start=this.les.end={col:(s=this.index(s)).col,row:s.row},this.renderSelection()}},edit:function(t){var i,e,o,s,r,n=t.node,l=t.quick;if(this._editing&&!(!(r=this.index(n))||r.col<0||r.row<0))return(i=this.editing).node=n,i.quick=l,i.on=!0,this.dom.layout.textContent=n.textContent,e=this.dom.layout.getBoundingClientRect(),o=n.getBoundingClientRect(),s=this.dom.sheet.getBoundingClientRect(),t=(i=[this.dom.sheet.scrollLeft,this.dom.sheet.scrollTop])[0],r=i[1],(i=this.dom.edit.style).left=o.x-s.x+t-2+"px",i.top=o.y-s.y+r-2+"px",i.width="fit-content",i.height="fit-content",this.dom.edit.classList.toggle("show",!0),(i=this.dom.textarea.style).width=Math.max(e.width,o.width+1)+"px",i.height=Math.max(e.height,o.height+1)+"px",this.dom.textarea.value=n=!l&&n.textContent||"",this.dom.textarea.focus(),this.dom.textarea.setSelectionRange(n.length,n.length)},edited:function(t){if(null==t&&(t={}),this.editing.on)return t.cancel||this.set({row:this.les.start.row,col:this.les.start.col,data:this.dom.textarea.value||""}),this.dom.edit.classList.toggle("show",!1),(t=this.editing).node=null,t.on=!1,t},index:function(t){var i=Array.from(this.dom.inner.childNodes).indexOf(t);return i<0?null:{x:t=i%this.dim.col,y:i=(i-t)/this.dim.col,col:t<this.xif.col[1]?-1:t<this.xif.col[2]?t-this.xif.col[1]:t-this.xif.col[1]+this.pos.col,row:i<this.xif.row[1]?-1:i<this.xif.row[2]?i-this.xif.row[1]:i-this.xif.row[1]+this.pos.row}},cell:function(t){var i,e,o;if(null!=(t=null==t?{}:t).col){if(t.col<this.frozen.col)i=t.col;else{if(t.col-this.pos.col<this.frozen.col)return null;i=t.col-this.pos.col}if(t.row<this.frozen.row)e=t.row;else{if(t.row-this.pos.row<this.frozen.row)return null;e=t.row-this.pos.row}return e=(o=[i+this.xif.col[1],e+this.xif.row[1]])[1],(i=o[0])<0||e<0||i>=this.dim.col||e>=this.dim.row?null:this.dom.inner.childNodes[e*this.dim.col+i]}if(!(o=t.node?this.index(t.node):{y:0,x:0}))throw new Error("node not found in sheet");return e=o.y+(t.y||0),i=o.x+(t.x||0),this.dom.inner.childNodes[e*this.dim.col+i]},editing:function(t){return null==t?this._editing:this._editing=!!t},renderSelection:function(){var t,i,e,o,s,r,n,l;if(this.les.start)return e=(t=this.les.start.col<this.les.end.col?[this.les.start.col,this.les.end.col]:[this.les.end.col,this.les.start.col])[0],n=t[1],r=(t=this.les.start.row<this.les.end.row?[this.les.start.row,this.les.end.row]:[this.les.end.row,this.les.start.row])[0],o=t[1],i=this.dom.inner.getBoundingClientRect(),l=(t=[this.cell({col:this.pos.col+this.frozen.col,row:this.pos.row+this.frozen.row}),this.cell({col:e,row:r}),this.cell({col:e,row:o}),this.cell({col:n,row:r}),this.cell({col:n,row:o})].map(function(t){return t?t.getBoundingClientRect():null}))[0],s=t[1],e=t[2],r=t[3],n=t[4],l.width=0,l.height=0,o=(s||e||l).x-i.x,s=(s||r||l).y-i.y,r=(r||n||l).x+(r||n||l).width-i.x-o+1,n=(e||n||l).y+(e||n||l).height-i.y-s+1,l=(l=this.cell(this.les.start))?l.getBoundingClientRect():null,(t=this.dom.range.style).left=o+"px",t.top=s+"px",t.width=r+"px",t.height=n+"px",this.dom.range.classList.toggle("show",!0),l&&((t=this.dom.caret.style).left=l.x-i.x-1+"px",t.top=l.y-i.y-1+"px",t.width=l.width+2+"px",t.height=l.height+2+"px",t.zIndex=this.les.start.row+this.xif.row[1]<this.xif.row[2]&&this.les.start.col+this.xif.col[1]<this.xif.col[2]?101:this.les.start.row+this.xif.row[1]<this.xif.row[2]||this.les.start.col+this.xif.col[1]<this.xif.col[2]?20:15),this.dom.caret.classList.toggle("show",!!l)},data:function(t){return null==t?this._data:(this._data=t,this.render())}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.sheet=t)}.call(this);
