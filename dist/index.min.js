!function(){var a,u,r,t;function i(t,e){var o,i={}.hasOwnProperty;for(o in e)i.call(e,o)&&(t[o]=e[o]);return t}a=function(t){return Papa.parse(t).data},u=function(t,e,o){for(var i=t;t&&t!==o;)t=t.parentNode;if(t!==o)return null;if(!e)return t;for(t=i;t&&t!==o&&(!t.matches||t.matches&&!t.matches(e));)t=t.parentNode;return t!==o||o.matches&&o.matches(e)?t:null},r=function(t){for(var e=Math.floor(Math.log(25*(t+1)+1)/Math.log(26))-1,o=t-((Math.pow(26,1+e)-1)/25-1),i="",s=0;s<=e;++s)i="ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(o%26)+i,o=(o-o%26)/26;return i},(t=function(t){var e,o=this;return this.opt=t=null==t?{}:t,this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.evtHandler={},this._data=t.data||[],this._size={row:(e=i({row:[],col:[]},t.size)).row,col:e.col},this.cls={row:(e=i({row:[],col:[]},t.class)).row,col:e.col},this._editing=null==t.editing||!!t.editing,this.dim={col:(t.dim||(t.dim={})).col||30,row:(t.dim||(t.dim={})).row||30},this.frozen={col:(e=i({col:0,row:0},t.frozen||{})).col,row:e.row},this.idx={col:(e=i({row:!0,col:!0},t.idx||{})).col,row:e.row},this.fixed={col:(e=i({col:0,row:0},t.fixed||{})).col,row:e.row},this.xif={row:[this.idx.row?1:0,0,0],col:[this.idx.col?1:0,0,0]},["row","col"].map(function(t){return o.xif[t][1]=o.xif[t][0]+o.fixed[t],o.xif[t][2]=o.xif[t][1]+o.frozen[t]}),this.fix={row:this.xif.row[2],col:this.xif.col[2]},this.pos={col:0,row:0},this.scrollPos={x:0,y:0},this.sel={cut:{}},this.les={},this.editing={},this.dom=Object.fromEntries(["sheet","inner","caret","range","edit","layout","range-cut"].map(function(t){var e;e=document.createElement("div");return e.classList.add(t),[t,e]})),this.dom.sheet.setAttribute("tabindex",-1),this.dom.textarea=document.createElement("textarea"),this.root.appendChild(this.dom.sheet),["inner","caret","range","edit","layout","range-cut"].map(function(t){return o.dom.sheet.appendChild(o.dom[t])}),this.dom.edit.appendChild(this.dom.textarea),this._init(),this}).prototype=i(Object.create(Object.prototype),{on:function(t,e){var o;return((o=this.evtHandler)[t]||(o[t]=[])).push(e)},fire:function(t){for(var e,o,i,s,r=[],n=[],l=1,h=arguments.length;l<h;++l)n.push(arguments[l]);for(e=n,l=0,i=(o=this.evtHandler[t]||[]).length;l<i;++l)s=o[l],r.push(s.apply(this,e));return r},_init:function(){for(var t,e,o,i,d,f=this,s=0,r=this.dim.row;s<r;++s)for(t=s,e=0,o=this.dim.col;e<o;++e)i=e,this.addCell(i,t);return this.regrid(),this.dom.textarea.addEventListener("mousedown",function(t){return t.stopPropagation()}),(d=this.dom.sheet).addEventListener("mousedown",function(t){var e,o,i;if(f.edited(),e=u(t.target,".cell",d))return(i={row:(o=f.index(e)).row,col:o.col}).col<0||i.row<0?(t.shiftKey&&f.les.start||(f.les.node=f.cell(f.les.start),f.les.start={col:0<(o=i.col)?o:0,row:0<(o=i.row)?o:0}),f.les.end={col:0<=i.col?i.col:void 0,row:0<=i.row?i.row:void 0},void f.renderSelection()):(t.shiftKey&&f.les.start?f.les.end=i:(f.les.start=f.les.end=i,f.les.node=e),f.renderSelection())}),d.addEventListener("mousemove",function(t){var e;if(!f.editing.on&&t.buttons&&(e=u(t.target,".cell",d)))return e={row:(e=f.index(e)).row,col:e.col},f.les.end={col:0<=e.col?e.col:void 0,row:0<=e.row?e.row:void 0},f.renderSelection()}),d.addEventListener("dblclick",function(t){if(t=u(t.target,".cell",d))return f.edit({node:t,quick:!1})}),document.body.addEventListener("paste",function(t){var e,o,i,s,r,n,l,h,c;if(u(document.activeElement,".sheet",d)&&f.les.start&&(s=t.clipboardData.getData("text"),e=a(s),f.set({row:f.les.start.row,col:f.les.start.col,data:e,range:!0}),f.sel.cut)){if(f._toText({sel:f.sel.cut})===s){for(o=(e=f._bound({sel:f.sel.cut})).sc,i=e.ec,s=e.sr,r=e.er,n=s;n<=r;++n)for(l=n,h=o;h<=i;++h)c=h,f.set({row:l,col:c,data:""});navigator.clipboard.writeText("")}return f.sel.cut=null,f.dom["range-cut"].classList.toggle("show",!1)}}),d.addEventListener("keydown",function(t){var e,o,i,s,r,n,l,h,c,d,a,u=t.keyCode;if(67===t.keyCode&&(t.metaKey||t.ctrlKey))return f.copy();if(88===t.keyCode&&(t.metaKey||t.ctrlKey))return f.copy({cut:!0});if(f.eventInScope(t)){if(8===u){if(!f.les.node)return;for(e=f._bound(),o=e.sc,i=e.ec,s=e.sr,r=e.er,l=[],h=s;h<=r;++h){for(c=[],d=o;d<=i;++d)c.push("");l.push(c)}n=l,f.set({row:s,col:o,data:n,range:!0})}return 189===u&&(t.metaKey||t.ctrlKey)?(e=f._bound({defined:!1}),o=e.sc,i=e.ec,s=e.sr,r=e.er,null==i&&(a=f._data.splice(s,r-s+1)),null==r&&(a=f._data.map(function(t){return t.splice(o,i-o+1)})),f.fire("change",{row:s,col:o,data:a,range:!0}),f.les.end=f.les.start,f.renderSelection(),void f.render()):!(a=function(){switch(u){case 37:return{y:0,x:-1};case 38:return{y:-1,x:0};case 39:return{y:0,x:1};case 40:return{y:1,x:0};default:return null}}())||f.editing.on&&!f.editing.quick?void 0:(f.move(a),t.stopPropagation(),t.preventDefault(),f.dom.sheet.focus())}}),d.addEventListener("keypress",function(t){if(31!==t.keyCode||!t.metaKey&&!t.ctrlKey)return f.les.node&&!f.editing.on?f.edit({node:f.les.node,quick:13!==t.keyCode}):void 0}),this.dom.textarea.addEventListener("keydown",function(t){var e,o,i;return 27===t.keyCode?(f.edited({cancel:!0}),t.stopPropagation(),t.preventDefault(),void f.dom.sheet.focus()):13!==t.keyCode||t.altKey||t.metaKey?13===t.keyCode&&(t.altKey||t.metaKey)?(f.dom.textarea.value+="\n",f.dom.layout.textContent=f.dom.textarea.value+" ",e=f.dom.layout.getBoundingClientRect(),o=f.editing.node.getBoundingClientRect(),(i=f.dom.textarea.style).width=Math.max(e.width,o.width+1)+"px",i.height=Math.max(e.height,o.height+1)+"px",i):void 0:(f.move({y:1,x:0}),t.stopPropagation(),t.preventDefault(),void f.dom.sheet.focus())}),document.addEventListener("wheel",function(t){var e,o,i,s,r=f.eventInScope(t);return(null==f.opt.scrollLock||f.opt.scrollLock)&&Math.abs(t.deltaX)>Math.abs(t.deltaY)&&(!r&&t.target!==document.body||t.preventDefault()),!!r&&(e=f.scrollPos,o=(s=[t.deltaX,t.deltaY])[0],i=s[1],o=(s=Math.abs(o)>Math.abs(i)?[o,0]:[0,i])[0],i=s[1],r=(s=[e.x,e.y])[0],s=s[1],e.x+=o/30,e.y+=i/30,o=Math.round(e.x)-Math.round(r),0<(i=Math.round(e.y)-Math.round(s))?f._md(i):i<0?f._mu(i):0<o?f._mr(o):o<0&&f._ml(o),f.renderSelection(),t.preventDefault())},{passive:!1})},select:function(t){var e,o;if(!arguments.length)return this.les.start?((e={}).col=this.les.start.col,e.row=this.les.start.row,this.les.end?(null==this.les.end.col?delete e.col:e.colspan=this.les.end.col-e.col+1,null==this.les.end.row?delete e.row:e.rowspan=this.les.end.row-e.row+1):(e.colspan=1,e.rowspan=1),e):null;this.les={},t&&(this.les={start:{col:0,row:0},end:{}},null!=t.row&&(this.les.start.row=t.row,this.les.end.row=t.row+((o=t.rowspan)&&1<o?o:1)-1),null!=t.col&&(this.les.start.col=t.col,this.les.end.col=t.col+((o=t.colspan)&&1<o?o:1)-1)),this.renderSelection()},_bound:function(t){var e,o=(r=(s=(r=[(i=(t=null==t?{}:t).sel||this.les).start,i.end])[0]).col<(e=r[1]).col||null==e.col?[s.col,e.col]:[e.col,s.col])[0],i=r[1],s=(r=s.row<e.row||null==e.row?[s.row,e.row]:[e.row,s.row])[0],r=r[1];return null!=t.defined&&!t.defined||(null==i&&(i=Math.max.apply(Math,this._data.map(function(t){return t.length}))),null==r&&(r=this._data.length)),{sc:o,ec:i,sr:s,er:r}},_toText:function(t){var e,o,i,s,r,n,l,h,c,d,t=t.sel;if(!t||!t.start)return"";for(e=[],i=(o=this._bound({sel:t})).sc,s=o.ec,t=o.sr,r=o.er,n=t;n<=r;++n){for(l=n,h=[],c=i;c<=s;++c)d=c,"object"!=typeof(d=null==(d=((o=this._data)[l]||(o[l]=[]))[d])?"":d)&&h.push('"'+(""+d||"").replace(/"/g,'""')+'"');e.push(h.join("\t"))}return e.join("\n")},copy:function(t){var e;if(null==t&&(t={}),this.les.start)return e=this._toText({sel:this.les}),navigator.clipboard.writeText(e),t.cut?(this.sel.cut={start:this.les.start,end:this.les.end},this.renderSelection(this.sel.cut,{cut:!0})):void 0},eventInScope:function(t){return u(t.target,".sheet",this.dom.sheet)===this.dom.sheet},size:function(t){return null==t?this._size:(this._size={row:(t=i({row:[],col:[]},t)).row,col:t.col},this.regrid())},regrid:function(){var e=this;return this.dom.inner.style.gridTemplateColumns="repeat("+this.xif.col[1]+", max-content) "+function(){for(var t=[],e=0,o=this.frozen.col;e<o;++e)t.push(e);return t}.call(this).map(function(t){return e._size.col[t]||"max-content"}).join(" ")+" "+function(){for(var t=[],e=this.xif.col[2],o=this.dim.col;e<o;++e)t.push(e);return t}.call(this).map(function(t){return e._size.col[t+e.pos.col-e.xif.col[1]]||"max-content"}).join(" "),this.dom.inner.style.gridTemplateRows="repeat("+this.xif.row[1]+", max-content) "+function(){for(var t=[],e=0,o=this.frozen.row;e<o;++e)t.push(e);return t}.call(this).map(function(t){return e._size.row[t]||"max-content"}).join(" ")+" "+function(){for(var t=[],e=this.xif.row[2],o=this.dim.row;e<o;++e)t.push(e);return t}.call(this).map(function(t){return e._size.row[t+e.pos.row-e.xif.row[1]]||"max-content"}).join(" ")},addCell:function(t,e){var o=document.createElement("div");return this.dom.inner.insertBefore(o,this.dom.inner.childNodes[e*this.dim.col+t]),this._content({x:t,y:e,n:o})},set:function(t){var e,o,i,s,r,n,l,h,c=t.row,d=t.col,a=t.data,t=t.range;if(t)for(o=0,i=a.length;o<i;++o)for(r=0,n=a[s=o].length;r<n;++r)l=r,((e=this._data)[h=s+c]||(e[h]=[]))[l+d]=a[s][l],this._content({y:s+c-this.pos.row+this.xif.row[1],x:l+d-this.pos.col+this.xif.col[1]});else((e=this._data)[c]||(e[c]=[]))[d]=a,this._content({y:c-this.pos.row+this.xif.row[1],x:d-this.pos.col+this.xif.col[1]});return this.fire("change",{row:c,col:d,data:a,range:!!t})},_content:function(t){var e,o,i=t.x,s=t.y,t=t.n;if(t=t||this.dom.inner.childNodes[i+s*this.dim.col])return e=(o=i<this.xif.col[0]&&s<this.xif.col[0]?["","cell idx"]:i<this.xif.col[0]?[s<this.xif.row[1]?" ":s<this.xif.row[2]?s-this.xif.row[1]+1:s-this.xif.row[1]+this.pos.row+1,"cell idx"]:s<this.xif.row[0]?[i<this.xif.col[1]?" ":i<this.xif.col[2]?r(i-this.xif.col[1]):r(i-this.xif.col[1]+this.pos.col),"cell idx"]:i<this.xif.col[1]||s<this.xif.row[1]?[null,"cell fixed"]:i<this.xif.col[2]&&s<this.xif.row[2]?[((o=this._data)[e=s-this.xif.row[1]]||(o[e]=[]))[i-this.xif.col[1]],"cell frozen fixed"]:i<this.xif.col[2]?[((o=this._data)[e=this.pos.row+s-this.xif.row[1]]||(o[e]=[]))[i-this.xif.col[1]],"cell frozen"]:s<this.xif.row[2]?[((o=this._data)[e=s-this.xif.row[1]]||(o[e]=[]))[this.pos.col+i-this.xif.col[1]],"cell frozen"]:[((o=this._data)[e=this.pos.row+s-this.xif.row[1]]||(o[e]=[]))[this.pos.col+i-this.xif.col[1]],"cell"])[0],o=o[1],null==e&&(e=""),s=i>=this.xif.col[0]&&s>=this.xif.row[0]?(this.cls.col[this.pos.col+i-this.xif.col[1]]||"")+" "+(this.cls.row[this.pos.row+s-this.xif.row[1]]||""):"",t.className=o+" "+s,null!==e?"object"!=typeof e?t.textContent=e:"dom"===e.type?(t.textContent="",t.appendChild(e.node)):void 0:void 0},_md:function(t){var e,o,i,s,r,n,l,h,c;for(null==t&&(t=1),e=this.dom.inner,i=o=0<(o=(t=Math.round(Math.abs(t)))-(this.dim.row-this.fix.row))?o:0;i<t;++i)for(s=i,r=0,n=this.dim.col;r<n&&(l=r,h=this.dim.col*this.fix.row,e.childNodes[h]);++r)e.removeChild(e.childNodes[h]);for(i=o;i<t;++i)for(s=i,r=0,n=this.dim.col;r<n;++r)l=r,c=document.createElement("div"),this._content({x:l,y:this.dim.row+s,n:c}),e.appendChild(c);return this.pos.row+=t},_mu:function(t){var e,o,i,s,r,n,l,h,c,d,a=[];if(null==t&&(t=1),e=this.dom.inner,!(this.pos.row<=0)){for(s=o=0<(i=(t=(t=Math.round(Math.abs(t)))>=this.pos.row?this.pos.row:t)-(this.dim.row-this.xif.row[2]))?i:0;s<t;++s)for(r=s,n=0,l=this.dim.col;n<l&&(h=n,e.childNodes.length);++n)e.removeChild(e.childNodes[e.childNodes.length-1]);for(this.pos.row-=t,s=o;s<t;++s){for(r=s,c=[],n=0,l=this.dim.col;n<l;++n)h=n,d=document.createElement("div"),this._content({x:h,y:r+this.xif.row[2],n:d}),c.push(e.insertBefore(d,e.childNodes[h+(r-o)*this.dim.col+this.dim.col*this.xif.row[2]]));a.push(c)}return a}},_mr:function(t){var e,o,i,s,r,n,l,h;for(null==t&&(t=1),e=this.dom.inner,i=0<(o=(t=Math.round(Math.abs(t)))-(this.dim.col-this.fix.col))?o:0;i<t;++i)for(s=i,r=0,n=this.dim.row;r<n;++r)l=r,e.removeChild(e.childNodes[l*this.dim.col+this.fix.col]),h=document.createElement("div"),this._content({x:this.dim.col+s,y:l,n:h}),e.insertBefore(h,e.childNodes[(l+1)*this.dim.col-1]);return this.pos.col+=t,this.regrid()},_ml:function(t){var e,o,i,s,r,n,l,h,c;if(null==t&&(t=1),e=this.dom.inner,(t=Math.round(Math.abs(t)))>=this.pos.col&&(t=this.pos.col),!(this.pos.col<=0||t<=0)){for(o=0<(i=t-(this.dim.col-this.xif.col[2]))?i:0,this.pos.col-=t,s=o;s<t;++s)for(r=s,n=0,l=this.dim.row;n<l;++n)h=n,e.removeChild(e.childNodes[(h+1)*this.dim.col-1]),c=document.createElement("div"),this._content({x:r+this.xif.col[2],y:h,n:c}),e.insertBefore(c,e.childNodes[h*this.dim.col+this.xif.col[2]+r-o]);return this.regrid()}},goto:function(t){return i(this.pos,t=null==t?{row:0,col:0}:t),this.render()},render:function(){for(var t,e,o,i,s=0,r=this.dim.row;s<r;++s)for(t=s,e=0,o=this.dim.col;e<o;++e)i=e,this._content({x:i,y:t});return this.renderSelection()},move:function(t){var e,o,i,s;if(null==t&&(t={}),this.editing.on&&this.edited(),(t.node=this.les.node)&&(s=this.cell(t))){if(e=this.index(s),o=s.getBoundingClientRect(),i=this.dom.sheet.getBoundingClientRect(),o.x+o.width>i.x+i.width&&this._mr(1),o.y+o.height>i.y+i.height&&this._md(1),0===e.x){if(0===this.pos.col)return;this._ml(1)}if(0===e.y){if(0===this.pos.row)return;this._mu(1)}if(s=this.cell(t))return this.les.node=s,this.les.start=this.les.end={col:(s=this.index(s)).col,row:s.row},this.renderSelection()}},edit:function(t){var e,o,i,s,r,n=t.node,l=t.quick;if(this._editing&&!(!(r=this.index(n))||r.col<0||r.row<0))return(e=this.editing).node=n,e.quick=l,e.on=!0,this.dom.layout.textContent=n.textContent,o=this.dom.layout.getBoundingClientRect(),i=n.getBoundingClientRect(),s=this.dom.sheet.getBoundingClientRect(),t=(e=[this.dom.sheet.scrollLeft,this.dom.sheet.scrollTop])[0],r=e[1],(e=this.dom.edit.style).left=i.x-s.x+t-2+"px",e.top=i.y-s.y+r-2+"px",e.width="fit-content",e.height="fit-content",this.dom.edit.classList.toggle("show",!0),(e=this.dom.textarea.style).width=Math.max(o.width,i.width+1)+"px",e.height=Math.max(o.height,i.height+1)+"px",this.dom.textarea.value=n=!l&&n.textContent||"",this.dom.textarea.focus(),this.dom.textarea.setSelectionRange(n.length,n.length)},edited:function(t){if(null==t&&(t={}),this.editing.on)return t.cancel||this.set({row:this.les.start.row,col:this.les.start.col,data:this.dom.textarea.value||""}),this.dom.edit.classList.toggle("show",!1),(t=this.editing).node=null,t.on=!1,t},index:function(t){var e=Array.from(this.dom.inner.childNodes).indexOf(t);return e<0?null:{x:t=e%this.dim.col,y:e=(e-t)/this.dim.col,col:t<this.xif.col[1]?-1:t<this.xif.col[2]?t-this.xif.col[1]:t-this.xif.col[1]+this.pos.col,row:e<this.xif.row[1]?-1:e<this.xif.row[2]?e-this.xif.row[1]:e-this.xif.row[1]+this.pos.row}},cell:function(t){var e,o,i,s=(t=null==t?{}:t).roughly;if(null!=t.col){if(t.col<this.frozen.col)e=t.col;else if(t.col-this.pos.col<this.frozen.col){if(!s)return null;e=this.frozen.col}else e=t.col-this.pos.col;if(t.row<this.frozen.row)o=t.row;else if(t.row-this.pos.row<this.frozen.row){if(!s)return null;o=this.frozen.row}else o=t.row-this.pos.row;return o=(i=[e+this.xif.col[1],o+this.xif.row[1]])[1],(e=i[0])<0||o<0||e>=this.dim.col||o>=this.dim.row?null:this.dom.inner.childNodes[o*this.dim.col+e]}if(!(i=t.node?this.index(t.node):{y:0,x:0}))throw new Error("node not found in sheet");return o=i.y+(t.y||0),e=i.x+(t.x||0),this.dom.inner.childNodes[o*this.dim.col+e]},editing:function(t){return null==t?this._editing:this._editing=!!t},renderSelection:function(t,e){var o,i,s,r,n,l,h,c,d,a,u,f;return null==e&&(e={}),(t=t||this.les).start?(l=(o=this._bound({defined:!1,sel:t})).sc,f=o.ec,h=o.sr,u=o.er,i=this.dom.inner.getBoundingClientRect(),a=(o=[this.cell({col:this.pos.col+this.frozen.col,row:this.pos.row+this.frozen.row}),this.cell({col:l,row:h,roughly:!0}),this.cell({col:l,row:u,roughly:!0}),this.cell({col:f,row:h,roughly:!0}),this.cell({col:f,row:u,roughly:!0})].map(function(t){return t?t.getBoundingClientRect():null}))[0],c=o[1],s=o[2],d=o[3],r=o[4],a.width=0,a.height=0,n=(c||s||a).x-i.x,l=(c||d||a).y-i.y,h=f-this.pos.col<0,c=u-this.pos.row<0,d=(d||r||a).x+(h?0:(d||r||a).width)-i.x-n+1,a=(s||r||a).y+(c?0:(s||r||a).height)-i.y-l+1,null==f&&(d=this.root.getBoundingClientRect().width),null==u&&(a=this.root.getBoundingClientRect().height),u=(f=this.cell(t.start))?f.getBoundingClientRect():null,(o=(f=e.cut?this.dom["range-cut"]:this.dom.range).style).left=n+"px",o.top=l+"px",o.width=d+"px",o.height=a+"px",f.classList.toggle("show",!0),e.cut?void 0:(u&&((o=this.dom.caret.style).left=u.x-i.x-1+"px",o.top=u.y-i.y-1+"px",o.width=(h?0:u.width)+2+"px",o.height=(c?0:u.height)+2+"px",o.zIndex=t.start.row+this.xif.row[1]<this.xif.row[2]&&t.start.col+this.xif.col[1]<this.xif.col[2]?101:t.start.row+this.xif.row[1]<this.xif.row[2]||t.start.col+this.xif.col[1]<this.xif.col[2]?20:15),this.dom.caret.classList.toggle("show",!!u))):(this.dom.caret.classList.toggle("show",!1),void this.dom.range.classList.toggle("show",!1))},data:function(t){return null==t?this._data:(this._data=t,this.render())}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.sheet=t)}.call(this);
