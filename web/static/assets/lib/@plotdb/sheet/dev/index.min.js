(function(){function t(t,i){var e={}.hasOwnProperty;for(var o in i)e.call(i,o)&&(t[o]=i[o]);return t}var i,e,o,s;i=function(t){return Papa.parse(t).data},e=function(t,i,e){var o;for(o=t;t&&t!==e;)t=t.parentNode;if(t!==e)return null;if(!i)return t;for(t=o;t&&t!==e&&(!t.matches||t.matches&&!t.matches(i));)t=t.parentNode;return t!==e||e.matches&&e.matches(i)?t:null},o=function(t){var i,e,o,s,r;for(i=Math.floor(Math.log(25*(t+1)+1)/Math.log(26))-1,e=t-((Math.pow(26,i+1)-1)/25-1),o="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="",r=0;r<=i;++r)r,s=o.charAt(e%26)+s,e=(e-e%26)/26;return s},(s=function(i){var e,o=this;return null==i&&(i={}),this.opt=i,this.root="string"==typeof i.root?document.querySelector(i.root):i.root,this.evtHandler={},this._data=i.data||[],this._size={row:(e=t({row:[],col:[]},i.size)).row,col:e.col},this.cls={row:(e=t({row:[],col:[]},i.class)).row,col:e.col},this._editing=null==i.editing||!!i.editing,this.dim={col:(i.dim||(i.dim={})).col||30,row:(i.dim||(i.dim={})).row||30},this.frozen={col:(e=t({col:0,row:0},i.frozen||{})).col,row:e.row},this.idx={col:(e=t({row:!0,col:!0},i.idx||{})).col,row:e.row},this.fixed={col:(e=t({col:0,row:0},i.fixed||{})).col,row:e.row},this.xif={row:[this.idx.row?1:0,0,0],col:[this.idx.col?1:0,0,0]},["row","col"].map(function(t){return o.xif[t][1]=o.xif[t][0]+o.fixed[t],o.xif[t][2]=o.xif[t][1]+o.frozen[t]}),this.fix={row:this.xif.row[2],col:this.xif.col[2]},this.pos={col:0,row:0},this.scrollPos={x:0,y:0},this.sel={},this.les={},this.editing={},this.dom=Object.fromEntries(["sheet","inner","caret","range","edit","layout"].map(function(t){var i;return(i=document.createElement("div")).classList.add(t),[t,i]})),this.dom.sheet.setAttribute("tabindex",-1),this.dom.textarea=document.createElement("textarea"),this.root.appendChild(this.dom.sheet),["inner","caret","range","edit","layout"].map(function(t){return o.dom.sheet.appendChild(o.dom[t])}),this.dom.edit.appendChild(this.dom.textarea),this._init(),this}).prototype=t(Object.create(Object.prototype),{on:function(t,i){var e;return((e=this.evtHandler)[t]||(e[t]=[])).push(i)},fire:function(t){var i,e,o,s,r,n,l,h=[];for(e=[],o=1,s=arguments.length;o<s;++o)e.push(arguments[o]);for(i=e,o=0,n=(r=this.evtHandler[t]||[]).length;o<n;++o)l=r[o],h.push(l.apply(this,i));return h},_init:function(){var t,o,s,r,n,l,h,d=this;for(t=0,o=this.dim.row;t<o;++t)for(s=t,r=0,n=this.dim.col;r<n;++r)l=r,this.addCell(l,s);return this.regrid(),this.dom.textarea.addEventListener("mousedown",function(t){return t.stopPropagation()}),(h=this.dom.sheet).addEventListener("mousedown",function(t){var i,o,s;if(d.edited(),(i=e(t.target,".cell",h))&&!((s={row:(o=d.index(i)).row,col:o.col}).col<0||s.row<0))return d.les.start=d.les.end=s,d.les.node=i,d.renderSelection()}),h.addEventListener("mousemove",function(t){var i,o;if(!d.editing.on&&t.buttons&&(i=e(t.target,".cell",h)))return d.les.end={row:(o=d.index(i)).row,col:o.col},d.renderSelection()}),h.addEventListener("dblclick",function(t){var i;if(i=e(t.target,".cell",h))return d.edit({node:i,quick:!1})}),document.body.addEventListener("paste",function(t){var o;if(e(document.activeElement,".sheet",h)&&d.les.start)return o=t.clipboardData.getData("text"),o=i(o),d.set({row:d.les.start.row,col:d.les.start.col,data:o,range:!0})}),h.addEventListener("keydown",function(t){var i,e,o,s,r,n,l,h,c,a,f,u,x;if(67===t.keyCode&&(t.metaKey||t.ctrlKey))return d.copy();if(d.eventInScope(t)){if(8===(i=t.keyCode)){if(!d.les.node)return;for(o=(e=[d.les.start,d.les.end])[0],s=e[1],r=(e=o.col<s.col?[o.col,s.col]:[s.col,o.col])[0],n=e[1],l=(e=o.row<s.row?[o.row,s.row]:[s.row,o.row])[0],h=e[1],c=l;c<=h;++c)for(a=c,f=r;f<=n;++f)u=f,d.set({row:a,col:u,data:""})}if((x=function(){switch(i){case 37:return{y:0,x:-1};case 38:return{y:-1,x:0};case 39:return{y:0,x:1};case 40:return{y:1,x:0};default:return null}}())&&(!d.editing.on||d.editing.quick))return d.move(x),t.stopPropagation(),t.preventDefault(),d.dom.sheet.focus()}}),h.addEventListener("keypress",function(t){if(d.les.node&&!d.editing.on)return d.edit({node:d.les.node,quick:13!==t.keyCode})}),this.dom.textarea.addEventListener("keydown",function(t){var i,e,o;return 27===t.keyCode?(d.edited({cancel:!0}),t.stopPropagation(),t.preventDefault(),void d.dom.sheet.focus()):13!==t.keyCode||t.altKey||t.metaKey?13===t.keyCode&&(t.altKey||t.metaKey)?(d.dom.textarea.value+="\n",d.dom.layout.textContent=d.dom.textarea.value+" ",i=d.dom.layout.getBoundingClientRect(),e=d.editing.node.getBoundingClientRect(),o=d.dom.textarea.style,o.width=Math.max(i.width,e.width+1)+"px",o.height=Math.max(i.height,e.height+1)+"px",o):void 0:(d.move({y:1,x:0}),t.stopPropagation(),t.preventDefault(),void d.dom.sheet.focus())}),document.addEventListener("wheel",function(t){var i,e,o,s,r,n,l;return i=d.eventInScope(t),(null==d.opt.scrollLock||d.opt.scrollLock)&&Math.abs(t.deltaX)>Math.abs(t.deltaY)&&(i||t.target===document.body)&&t.preventDefault(),!!i&&(e=d.scrollPos,o=[t.deltaX,t.deltaY],s=o[0],r=o[1],o=Math.abs(s)>Math.abs(r)?[s,0]:[0,r],s=o[0],r=o[1],o=[e.x,e.y],n=o[0],l=o[1],e.x+=s/30,e.y+=r/30,s=Math.round(e.x)-Math.round(n),(r=Math.round(e.y)-Math.round(l))>0?d._md(r):r<0?d._mu(r):s>0?d._mr(s):s<0&&d._ml(s),d.renderSelection(),t.preventDefault())},{passive:!1})},copy:function(){var t,i,e,o,s,r,n,l,h,d;if(this.les.start){for(t=[],i=this.les.start.row,e=this.les.end.row+1;i<e;++i){for(i,o=[],s=this.les.start.col,r=this.les.end.col+1;s<r;++s)n=s,"object"!=typeof(l=((h=this._data)[rpw]||(h[rpw]=[]))[n])&&o.push('"'+(""+l||"").replace(/"/g,'""')+'"');t.push(o.join("\t"))}return d=t.join("\n"),navigator.clipboard.writeText(d)}},eventInScope:function(t){return e(t.target,".sheet",this.dom.sheet)===this.dom.sheet},size:function(i){var e;return null==i?this._size:(this._size={row:(e=t({row:[],col:[]},i)).row,col:e.col},this.regrid())},regrid:function(){var t=this;return this.dom.inner.style.gridTemplateColumns="repeat("+this.xif.col[1]+", max-content) "+function(){var t,i,e=[];for(t=0,i=this.frozen.col;t<i;++t)e.push(t);return e}.call(this).map(function(i){return t._size.col[i]||"max-content"}).join(" ")+" "+function(){var t,i,e=[];for(t=this.xif.col[2],i=this.dim.col;t<i;++t)e.push(t);return e}.call(this).map(function(i){return t._size.col[i+t.pos.col-t.xif.col[1]]||"max-content"}).join(" "),this.dom.inner.style.gridTemplateRows="repeat("+this.xif.row[1]+", max-content) "+function(){var t,i,e=[];for(t=0,i=this.frozen.row;t<i;++t)e.push(t);return e}.call(this).map(function(i){return t._size.row[i]||"max-content"}).join(" ")+" "+function(){var t,i,e=[];for(t=this.xif.row[2],i=this.dim.row;t<i;++t)e.push(t);return e}.call(this).map(function(i){return t._size.row[i+t.pos.row-t.xif.row[1]]||"max-content"}).join(" ")},addCell:function(t,i){var e;return e=document.createElement("div"),this.dom.inner.insertBefore(e,this.dom.inner.childNodes[i*this.dim.col+t]),this._content({x:t,y:i,n:e})},set:function(t){var i,e,o,s,r,n,l,h,d,c,a,f;if(i=t.row,e=t.col,o=t.data,s=t.range)for(n=0,l=o.length;n<l;++n)for(d=0,c=o[h=n].length;d<c;++d)a=d,((r=this._data)[f=h+i]||(r[f]=[]))[a+e]=o[h][a],this._content({y:h+i-this.pos.row+this.xif.row[1],x:a+e-this.pos.col+this.xif.col[1]});else((r=this._data)[i]||(r[i]=[]))[e]=o,this._content({y:i-this.pos.row+this.xif.row[1],x:e-this.pos.col+this.xif.col[1]});return this.fire("change",{row:i,col:e,data:o,range:!!s})},_content:function(t){var i,e,s,r,n,l,h,d,c;if(i=t.x,e=t.y,((s=t.n)||(s=this.dom.inner.childNodes[i+e*this.dim.col]))&&(n=i<this.xif.col[0]&&e<this.xif.col[0]?["","cell idx"]:i<this.xif.col[0]?(r=e<this.xif.row[1]?" ":e<this.xif.row[2]?e-this.xif.row[1]+1:e-this.xif.row[1]+this.pos.row+1,[r,"cell idx"]):e<this.xif.row[0]?(r=i<this.xif.col[1]?" ":o(i<this.xif.col[2]?i-this.xif.col[1]:i-this.xif.col[1]+this.pos.col),[r,"cell idx"]):i<this.xif.col[1]?[null,"cell fixed"]:e<this.xif.row[1]?[null,"cell fixed"]:i<this.xif.col[2]&&e<this.xif.row[2]?[((n=this._data)[l=e-this.xif.row[1]]||(n[l]=[]))[i-this.xif.col[1]],"cell frozen fixed"]:i<this.xif.col[2]?[((n=this._data)[l=this.pos.row+e-this.xif.row[1]]||(n[l]=[]))[i-this.xif.col[1]],"cell frozen"]:e<this.xif.row[2]?[((n=this._data)[l=e-this.xif.row[1]]||(n[l]=[]))[this.pos.col+i-this.xif.col[1]],"cell frozen"]:[((n=this._data)[l=this.pos.row+e-this.xif.row[1]]||(n[l]=[]))[this.pos.col+i-this.xif.col[1]],"cell"],h=n[0],d=n[1],null==h&&(h=""),c=i>=this.xif.col[0]&&e>=this.xif.row[0]?(this.cls.col[this.pos.col+i-this.xif.col[1]]||"")+" "+(this.cls.row[this.pos.row+e-this.xif.row[1]]||""):"",s.className=d+" "+c,null!==h)){if("object"!=typeof h)return s.textContent=h;if("dom"===h.type)return s.textContent="",s.appendChild(h.node)}},_md:function(t){var i,e,o,s,r,n,l,h,d,c;for(null==t&&(t=1),i=this.dom.inner,s=e=(o=(t=Math.round(Math.abs(t)))-(this.dim.row-this.fix.row))>0?o:0;s<t;++s)for(r=s,n=0,l=this.dim.col;n<l&&(h=n,d=this.dim.col*this.fix.row,i.childNodes[d]);++n)i.removeChild(i.childNodes[d]);for(s=e;s<t;++s)for(r=s,n=0,l=this.dim.col;n<l;++n)h=n,c=document.createElement("div"),this._content({x:h,y:this.dim.row+r,n:c}),i.appendChild(c);return this.pos.row+=t},_mu:function(t){var i,e,o,s,r,n,l,h,d,c,a=[];if(null==t&&(t=1),i=this.dom.inner,!(this.pos.row<=0)){for((t=Math.round(Math.abs(t)))>=this.pos.row&&(t=this.pos.row),s=e=(o=t-(this.dim.row-this.xif.row[2]))>0?o:0;s<t;++s)for(r=s,n=0,l=this.dim.col;n<l&&(h=n,i.childNodes.length);++n)i.removeChild(i.childNodes[i.childNodes.length-1]);for(this.pos.row-=t,s=e;s<t;++s){for(r=s,d=[],n=0,l=this.dim.col;n<l;++n)h=n,c=document.createElement("div"),this._content({x:h,y:r+this.xif.row[2],n:c}),d.push(i.insertBefore(c,i.childNodes[h+(r-e)*this.dim.col+this.dim.col*this.xif.row[2]]));a.push(d)}return a}},_mr:function(t){var i,e,o,s,r,n,l,h;for(null==t&&(t=1),i=this.dom.inner,o=(e=(t=Math.round(Math.abs(t)))-(this.dim.col-this.fix.col))>0?e:0;o<t;++o)for(s=o,r=0,n=this.dim.row;r<n;++r)l=r,i.removeChild(i.childNodes[l*this.dim.col+this.fix.col]),h=document.createElement("div"),this._content({x:this.dim.col+s,y:l,n:h}),i.insertBefore(h,i.childNodes[(l+1)*this.dim.col-1]);return this.pos.col+=t,this.regrid()},_ml:function(t){var i,e,o,s,r,n,l,h,d;if(null==t&&(t=1),i=this.dom.inner,(t=Math.round(Math.abs(t)))>=this.pos.col&&(t=this.pos.col),!(this.pos.col<=0||t<=0)){for(e=(o=t-(this.dim.col-this.xif.col[2]))>0?o:0,this.pos.col-=t,s=e;s<t;++s)for(r=s,n=0,l=this.dim.row;n<l;++n)h=n,i.removeChild(i.childNodes[(h+1)*this.dim.col-1]),d=document.createElement("div"),this._content({x:r+this.xif.col[2],y:h,n:d}),i.insertBefore(d,i.childNodes[h*this.dim.col+this.xif.col[2]+r-e]);return this.regrid()}},goto:function(i){return null==i&&(i={row:0,col:0}),t(this.pos,i),this.render()},render:function(){var t,i,e,o,s,r,n,l=[];for(t=0,i=this.dim.row;t<i;++t){for(e=t,o=[],s=0,r=this.dim.col;s<r;++s)n=s,o.push(this._content({x:n,y:e}));l.push(o)}return l},move:function(t){var i,e,o,s,r;if(null==t&&(t={}),this.editing.on&&this.edited(),(t.node=this.les.node)&&(i=this.cell(t))){if(e=this.index(i),o=i.getBoundingClientRect(),s=this.dom.sheet.getBoundingClientRect(),o.x+o.width>s.x+s.width&&this._mr(1),o.y+o.height>s.y+s.height&&this._md(1),0===e.x){if(0===this.pos.col)return;this._ml(1)}if(0===e.y){if(0===this.pos.row)return;this._mu(1)}if(i=this.cell(t))return this.les.node=i,this.les.start=this.les.end={col:(r=this.index(i)).col,row:r.row},this.renderSelection()}},edit:function(t){var i,e,o,s,r,n,l,h,d,c;if(i=t.node,e=t.quick,this._editing&&!(!(o=this.index(i))||o.col<0||o.row<0))return s=this.editing,s.node=i,s.quick=e,s.on=!0,this.dom.layout.textContent=i.textContent,r=this.dom.layout.getBoundingClientRect(),n=i.getBoundingClientRect(),l=this.dom.sheet.getBoundingClientRect(),s=[this.dom.sheet.scrollLeft,this.dom.sheet.scrollTop],h=s[0],d=s[1],s=this.dom.edit.style,s.left=n.x-l.x+h-2+"px",s.top=n.y-l.y+d-2+"px",s.width="fit-content",s.height="fit-content",this.dom.edit.classList.toggle("show",!0),s=this.dom.textarea.style,s.width=Math.max(r.width,n.width+1)+"px",s.height=Math.max(r.height,n.height+1)+"px",this.dom.textarea.value=c=e?"":i.textContent||"",this.dom.textarea.focus(),this.dom.textarea.setSelectionRange(c.length,c.length)},edited:function(t){var i;if(null==t&&(t={}),this.editing.on)return t.cancel||this.set({row:this.les.start.row,col:this.les.start.col,data:this.dom.textarea.value||""}),this.dom.edit.classList.toggle("show",!1),i=this.editing,i.node=null,i.on=!1,i},index:function(t){var i,e,o,s,r;return(i=Array.from(this.dom.inner.childNodes).indexOf(t))<0?null:(e=i%this.dim.col,o=(i-e)/this.dim.col,s=e<this.xif.col[1]?-1:e<this.xif.col[2]?e-this.xif.col[1]:e-this.xif.col[1]+this.pos.col,r=o<this.xif.row[1]?-1:o<this.xif.row[2]?o-this.xif.row[1]:o-this.xif.row[1]+this.pos.row,{x:e,y:o,col:s,row:r})},cell:function(t){var i,e,o,s;if(null==t&&(t={}),null!=t.col){if(t.col<this.frozen.col)i=t.col;else{if(t.col-this.pos.col<this.frozen.col)return null;i=t.col-this.pos.col}if(t.row<this.frozen.row)e=t.row;else{if(t.row-this.pos.row<this.frozen.row)return null;e=t.row-this.pos.row}return o=[i+this.xif.col[1],e+this.xif.row[1]],i=o[0],e=o[1],i<0||e<0||i>=this.dim.col||e>=this.dim.row?null:this.dom.inner.childNodes[e*this.dim.col+i]}if(!(s=t.node?this.index(t.node):{y:0,x:0}))throw new Error("node not found in sheet");return e=s.y+(t.y||0),i=s.x+(t.x||0),this.dom.inner.childNodes[e*this.dim.col+i]},editing:function(t){return null==t?this._editing:this._editing=!!t},renderSelection:function(){var t,i,e,o,s,r,n,l,h,d,c,a,f,u,x,w,m,p,g,v,y,_,C,M;if(this.les.start)return t=this.les.start.col<this.les.end.col?[this.les.start.col,this.les.end.col]:[this.les.end.col,this.les.start.col],i=t[0],e=t[1],t=this.les.start.row<this.les.end.row?[this.les.start.row,this.les.end.row]:[this.les.end.row,this.les.start.row],o=t[0],s=t[1],r=this.dom.inner.getBoundingClientRect(),n=this.cell({col:this.pos.col+this.frozen.col,row:this.pos.row+this.frozen.row}),l=this.cell({col:i,row:o}),h=this.cell({col:i,row:s}),d=this.cell({col:e,row:o}),c=this.cell({col:e,row:s}),t=[n,l,h,d,c].map(function(t){return t?t.getBoundingClientRect():null}),a=t[0],f=t[1],u=t[2],x=t[3],w=t[4],a.width=0,a.height=0,m=(f||u||a).x-r.x,p=(f||x||a).y-r.y,g=(x||w||a).x+(x||w||a).width-r.x,v=(u||w||a).y+(u||w||a).height-r.y,y=g-m+1,_=v-p+1,C=this.cell(this.les.start),M=C?C.getBoundingClientRect():null,t=this.dom.range.style,t.left=m+"px",t.top=p+"px",t.width=y+"px",t.height=_+"px",this.dom.range.classList.toggle("show",!0),M&&((t=this.dom.caret.style).left=M.x-r.x-1+"px",t.top=M.y-r.y-1+"px",t.width=M.width+2+"px",t.height=M.height+2+"px",t.zIndex=this.les.start.row+this.xif.row[1]<this.xif.row[2]&&this.les.start.col+this.xif.col[1]<this.xif.col[2]?101:this.les.start.row+this.xif.row[1]<this.xif.row[2]||this.les.start.col+this.xif.col[1]<this.xif.col[2]?20:15),this.dom.caret.classList.toggle("show",!!M)},data:function(t){return null==t?this._data:(this._data=t,this.render())}}),"undefined"!=typeof module&&null!==module?module.exports=s:"undefined"!=typeof window&&null!==window&&(window.sheet=s)}).call(this);
