(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.otJson0=f()}})(function(){var define,module,exports;function bootstrapTransform(r,t,n,e){var l=r.transformX=function(r,o){n(r),n(o);for(var f,a,h,g=[],i=0;i<o.length;i++){for(var u=o[i],s=[],v=0;v<r.length;){var m=[];if(f=r[v],h=m,t(s,f,a=u,"left"),t(h,a,f,"right"),v++,1!==m.length){if(0===m.length){for(var b=v;b<r.length;b++){e(s,r[b])}u=null;break}for(var c=l(r.slice(v),m),p=0;p<c[0].length;p++){e(s,c[0][p])}for(var k=0;k<c[1].length;k++){e(g,c[1][k])}u=null;break}u=m[0]}null!=u&&e(g,u),r=s}return[r,g]};r.transform=function(r,n,e){if("left"!==e&&"right"!==e){throw new Error("type must be 'left' or 'right'")}return 0===n.length?r:1===r.length&&1===n.length?t([],r[0],n[0],e):"left"===e?l(r,n)[0]:l(n,r)[1]}}var _$bootstrapTransform_1=bootstrapTransform;var _$text0_3={};var text=_$text0_3={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(e){if(null!=e&&"string"!=typeof e){throw new Error("Initial data must be a string")}return e||""}},strInject=function(e,n,t){return e.slice(0,n)+t+e.slice(n)},checkValidComponent=function(e){if("number"!=typeof e.p){throw new Error("component missing position field")}if("string"==typeof e.i==("string"==typeof e.d)){throw new Error("component needs an i or d field")}if(e.p<0){throw new Error("position cannot be negative")}},checkValidOp=function(e){for(var n=0;n<e.length;n++){checkValidComponent(e[n])}};text.apply=function(e,n){var t;checkValidOp(n);for(var p=0;p<n.length;p++){var r=n[p];if(null!=r.i){e=strInject(e,r.p,r.i)}else{if(t=e.slice(r.p,r.p+r.d.length),r.d!==t){throw new Error("Delete component '"+r.d+"' does not match deleted text '"+t+"'")}e=e.slice(0,r.p)+e.slice(r.p+r.d.length)}}return e};var append=text._append=function(e,n){if(""!==n.i&&""!==n.d){if(0===e.length){e.push(n)}else{var t=e[e.length-1];null!=t.i&&null!=n.i&&t.p<=n.p&&n.p<=t.p+t.i.length?e[e.length-1]={i:strInject(t.i,n.p-t.p,n.i),p:t.p}:null!=t.d&&null!=n.d&&n.p<=t.p&&t.p<=n.p+n.d.length?e[e.length-1]={d:strInject(n.d,t.p-n.p,t.d),p:n.p}:e.push(n)}}};text.compose=function(e,n){checkValidOp(e),checkValidOp(n);for(var t=e.slice(),p=0;p<n.length;p++){append(t,n[p])}return t},text.normalize=function(e){var n=[];null==e.i&&null==e.p||(e=[e]);for(var t=0;t<e.length;t++){var p=e[t];null==p.p&&(p.p=0),append(n,p)}return n};var transformPosition=function(e,n,t){return null!=n.i?n.p<e||n.p===e&&t?e+n.i.length:e:e<=n.p?e:e<=n.p+n.d.length?n.p:e-n.d.length};text.transformCursor=function(e,n,t){for(var p="right"===t,r=0;r<n.length;r++){e=transformPosition(e,n[r],p)}return e};var transformComponent=text._tc=function(e,n,t,p){if(checkValidComponent(n),checkValidComponent(t),null!=n.i){append(e,{i:n.i,p:transformPosition(n.p,t,"right"===p)})}else if(null!=t.i){var r=n.d;n.p<t.p&&(append(e,{d:r.slice(0,t.p-n.p),p:n.p}),r=r.slice(t.p-n.p)),""!==r&&append(e,{d:r,p:n.p+t.i.length})}else if(n.p>=t.p+t.d.length){append(e,{d:n.d,p:n.p-t.d.length})}else if(n.p+n.d.length<=t.p){append(e,n)}else{var i={d:"",p:n.p};n.p<t.p&&(i.d=n.d.slice(0,t.p-n.p)),n.p+n.d.length>t.p+t.d.length&&(i.d+=n.d.slice(t.p+t.d.length-n.p));var o=Math.max(n.p,t.p),l=Math.min(n.p+n.d.length,t.p+t.d.length);if(n.d.slice(o-n.p,l-n.p)!==t.d.slice(o-t.p,l-t.p)){throw new Error("Delete ops delete different text in the same region of the document")}""!==i.d&&(i.p=transformPosition(i.p,t),append(e,i))}return e},invertComponent=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}};text.invert=function(e){e=e.slice().reverse();for(var n=0;n<e.length;n++){e[n]=invertComponent(e[n])}return e},_$bootstrapTransform_1(text,transformComponent,checkValidOp,append);var _$json0_2={};var isArray=function(o){return"[object Array]"==Object.prototype.toString.call(o)},isObject=function(o){return!!o&&o.constructor===Object},clone=function(o){return JSON.parse(JSON.stringify(o))},json={name:"json0",uri:"http://sharejs.org/types/JSONv0"},subtypes={};function convertFromText(o){o.t="text0";var n={p:o.p.pop()};null!=o.si&&(n.i=o.si),null!=o.sd&&(n.d=o.sd),o.o=[n]}function convertToText(o){o.p.push(o.o[0].p),null!=o.o[0].i&&(o.si=o.o[0].i),null!=o.o[0].d&&(o.sd=o.o[0].d),delete o.t,delete o.o}json.registerSubtype=function(o){subtypes[o.name]=o},json.create=function(o){return void 0===o?null:clone(o)},json.invertComponent=function(o){var n={p:o.p};return o.t&&subtypes[o.t]&&(n.t=o.t,n.o=subtypes[o.t].invert(o.o)),void 0!==o.si&&(n.sd=o.si),void 0!==o.sd&&(n.si=o.sd),void 0!==o.oi&&(n.od=o.oi),void 0!==o.od&&(n.oi=o.od),void 0!==o.li&&(n.ld=o.li),void 0!==o.ld&&(n.li=o.ld),void 0!==o.na&&(n.na=-o.na),void 0!==o.lm&&(n.lm=o.p[o.p.length-1],n.p=o.p.slice(0,o.p.length-1).concat([o.lm])),n},json.invert=function(o){for(var n=o.slice().reverse(),e=[],i=0;i<n.length;i++){e.push(json.invertComponent(n[i]))}return e},json.checkValidOp=function(o){for(var n=0;n<o.length;n++){if(!isArray(o[n].p)){throw new Error("Missing path")}}},json.checkList=function(o){if(!isArray(o)){throw new Error("Referenced element not a list")}},json.checkObj=function(o){if(!isObject(o)){throw new Error("Referenced element not an object (it was "+JSON.stringify(o)+")")}},json.apply=function(o,n){json.checkValidOp(n),n=clone(n);for(var e={data:o},i=0;i<n.length;i++){var l=n[i];null==l.si&&null==l.sd||convertFromText(l);for(var t=null,r=e,s="data",p=0;p<l.p.length;p++){var d=l.p[p];if(t=r,s,r=r[s],s=d,null==t){throw new Error("Path invalid")}}if(l.t&&void 0!==l.o&&subtypes[l.t]){r[s]=subtypes[l.t].apply(r[s],l.o)}else if(void 0!==l.na){if("number"!=typeof r[s]){throw new Error("Referenced element not a number")}r[s]+=l.na}else if(void 0!==l.li&&void 0!==l.ld){json.checkList(r),r[s]=l.li}else if(void 0!==l.li){json.checkList(r),r.splice(s,0,l.li)}else if(void 0!==l.ld){json.checkList(r),r.splice(s,1)}else if(void 0!==l.lm){if(json.checkList(r),l.lm!=s){var u=r[s];r.splice(s,1),r.splice(l.lm,0,u)}}else if(void 0!==l.oi){json.checkObj(r),r[s]=l.oi}else{if(void 0===l.od){throw new Error("invalid / missing instruction in op")}json.checkObj(r),delete r[s]}}return e.data},json.shatter=function(o){for(var n=[],e=0;e<o.length;e++){n.push([o[e]])}return n},json.incrementalApply=function(o,n,e){for(var i=0;i<n.length;i++){var l=[n[i]];e(l,o=json.apply(o,l))}return o};var pathMatches=json.pathMatches=function(o,n,e){if(o.length!=n.length){return!1}for(var i=0;i<o.length;i++){if(o[i]!==n[i]&&(!e||i!==o.length-1)){return!1}}return!0};json.append=function(o,n){if(n=clone(n),0!==o.length){var e=o[o.length-1];if(null==n.si&&null==n.sd||null==e.si&&null==e.sd||(convertFromText(n),convertFromText(e)),pathMatches(n.p,e.p)){if(n.t&&e.t&&n.t===e.t&&subtypes[n.t]){if(e.o=subtypes[n.t].compose(e.o,n.o),null!=n.si||null!=n.sd){for(var i=n.p,l=0;l<e.o.length-1;l++){n.o=[e.o.pop()],n.p=i.slice(),convertToText(n),o.push(n)}convertToText(e)}}else{null!=e.na&&null!=n.na?o[o.length-1]={p:e.p,na:e.na+n.na}:void 0!==e.li&&void 0===n.li&&n.ld===e.li?void 0!==e.ld?delete e.li:o.pop():void 0!==e.od&&void 0===e.oi&&void 0!==n.oi&&void 0===n.od?e.oi=n.oi:void 0!==e.oi&&void 0!==n.od?void 0!==n.oi?e.oi=n.oi:void 0!==e.od?delete e.oi:o.pop():void 0!==n.lm&&n.p[n.p.length-1]===n.lm||o.push(n)}}else{null==n.si&&null==n.sd||null==e.si&&null==e.sd||(convertToText(n),convertToText(e)),o.push(n)}}else{o.push(n)}},json.compose=function(o,n){json.checkValidOp(o),json.checkValidOp(n);for(var e=clone(o),i=0;i<n.length;i++){json.append(e,n[i])}return e},json.normalize=function(o){var n=[];o=isArray(o)?o:[o];for(var e=0;e<o.length;e++){var i=o[e];null==i.p&&(i.p=[]),json.append(n,i)}return n},json.commonLengthForOps=function(o,n){var e=o.p.length,i=n.p.length;if((null!=o.na||o.t)&&e++,(null!=n.na||n.t)&&i++,0===e){return-1}if(0===i){return null}e--,i--;for(var l=0;l<e;l++){var t=o.p[l];if(l>=i||t!==n.p[l]){return null}}return e},json.canOpAffectPath=function(o,n){return null!=json.commonLengthForOps({p:n},o)},json.transformComponent=function(o,n,e,i){n=clone(n);var l=json.commonLengthForOps(e,n),t=json.commonLengthForOps(n,e),r=n.p.length,s=e.p.length;if((null!=n.na||n.t)&&r++,(null!=e.na||e.t)&&s++,null!=t&&s>r&&n.p[t]==e.p[t]){if(void 0!==n.ld){(d=clone(e)).p=d.p.slice(r),n.ld=json.apply(clone(n.ld),[d])}else if(void 0!==n.od){(d=clone(e)).p=d.p.slice(r),n.od=json.apply(clone(n.od),[d])}}if(null!=l){var p=r==s,d=e;if(null==n.si&&null==n.sd||null==e.si&&null==e.sd||(convertFromText(n),convertFromText(d=clone(e))),d.t&&subtypes[d.t]){if(n.t&&n.t===d.t){var u=subtypes[n.t].transform(n.o,d.o,i);if(null!=n.si||null!=n.sd){for(var c=n.p,f=0;f<u.length;f++){n.o=[u[f]],n.p=c.slice(),convertToText(n),json.append(o,n)}}else{(!isArray(u)||u.length>0)&&(n.o=u,json.append(o,n))}return o}}else if(void 0!==e.na){}else if(void 0!==e.li&&void 0!==e.ld){if(e.p[l]===n.p[l]){if(!p){return o}if(void 0!==n.ld){if(void 0===n.li||"left"!==i){return o}n.ld=clone(e.li)}}}else if(void 0!==e.li){void 0!==n.li&&void 0===n.ld&&p&&n.p[l]===e.p[l]?"right"===i&&n.p[l]++:e.p[l]<=n.p[l]&&n.p[l]++,void 0!==n.lm&&p&&e.p[l]<=n.lm&&n.lm++}else if(void 0!==e.ld){if(void 0!==n.lm&&p){if(e.p[l]===n.p[l]){return o}c=e.p[l];var a=n.p[l];(c<(v=n.lm)||c===v&&a<v)&&n.lm--}if(e.p[l]<n.p[l]){n.p[l]--}else if(e.p[l]===n.p[l]){if(s<r){return o}if(void 0!==n.ld){if(void 0===n.li){return o}delete n.ld}}}else if(void 0!==e.lm){if(void 0!==n.lm&&r===s){a=n.p[l];var v=n.lm,h=e.p[l],m=e.lm;if(h!==m){if(a===h){if("left"!==i){return o}n.p[l]=m,a===v&&(n.lm=m)}else{a>h&&n.p[l]--,a>m?n.p[l]++:a===m&&h>m&&(n.p[l]++,a===v&&n.lm++),v>h?n.lm--:v===h&&v>a&&n.lm--,v>m?n.lm++:v===m&&(m>h&&v>a||m<h&&v<a?"right"===i&&n.lm++:v>a?n.lm++:v===h&&n.lm--)}}}else if(void 0!==n.li&&void 0===n.ld&&p){a=e.p[l],v=e.lm;(c=n.p[l])>a&&n.p[l]--,c>v&&n.p[l]++}else{a=e.p[l],v=e.lm;(c=n.p[l])===a?n.p[l]=v:(c>a&&n.p[l]--,c>v?n.p[l]++:c===v&&a>v&&n.p[l]++)}}else if(void 0!==e.oi&&void 0!==e.od){if(n.p[l]===e.p[l]){if(void 0===n.oi||!p){return o}if("right"===i){return o}n.od=e.oi}}else if(void 0!==e.oi){if(void 0!==n.oi&&n.p[l]===e.p[l]){if("left"!==i){return o}json.append(o,{p:n.p,od:e.oi})}}else if(void 0!==e.od&&n.p[l]==e.p[l]){if(!p){return o}if(void 0===n.oi){return o}delete n.od}}return json.append(o,n),o},_$bootstrapTransform_1(json,json.transformComponent,json.checkValidOp,json.append);json.registerSubtype(_$text0_3),_$json0_2=json;var _$otJson0_otJson0={type:_$json0_2}});
